name: Non Linear State Space
category: systems
type: non_linear_state_space

summary: >
  User-defined non linear state space function implemented in Python.

description: |
  This block evaluates a user-provided Python function of the form:
      x+ = f(t, dt, x, u1, u2, ...)
      y = g(t, dt, x)

  The function is loaded from an external Python file and executed at each
  simulation step. Input and output ports are explicitly declared via
  `input_keys` and `output_keys`.

  This block is stateless and has direct feedthrough.

parameters:
  file_path:
    type: string
    required: true
    description: >
      Absolute path to the Python file containing the function.

  state_function_name:
    type: string
    required: true
    description: >
      Name of the state function to call inside the Python file.

  output_function_name:
    type: string
    required: true
    description: >
      Name of the output function to call inside the Python file.

  input_keys:
    type: list[string]
    required: true
    description: >
      List of input port names. These must match the function arguments
      after (t, dt).

  output_keys:
    type: list[string]
    required: true
    description: >
      List of output port names. The function must return a dict with
      exactly these keys.

  sample_time:
    type: float
    required: false
    description: >
      Optional execution period of the block.

ports:
  inputs:
    - name: in
      dynamic: true
      pattern: "{val}"
      source:
        type: parameter
        parameter: input_keys
        operation: keys

  outputs:
    - name: out
      dynamic: true
      pattern: "{val}"
      source:
        type: parameter
        parameter: output_keys
        operation: keys

execution:
  direct_feedthrough: false
  has_state: true
